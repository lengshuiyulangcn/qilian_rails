<% content_for :extra_head do %>
  <link rel="stylesheet" type="text/css" href="/assets/md_preview.css" />
  <script type="text/javascript" src="/assets/Markdown.Converter.js"></script>
  <script type="text/javascript" src="/assets/Markdown.Sanitizer.js"></script>
  <script type="text/javascript" src="/assets/Markdown.Editor.js"></script>
<% end %>
<!-- Page Content -->
  <div class="row">
      <div class="col-lg-12">
          <h1 class="page-header">
              写文章
          </h1>
      </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <%= form_for @post do |f| %>
      <div class="form-group">
        <label>标题</label>
        <%=f.text_field :title, class: 'form-control' %>
      </div>

      <div class="form-group">
        <label>简介</label>
        <%=f.text_area :description, class: 'form-control', rows: 4 %>
      </div>

      <div class="form-group" id='editor'>
        <label>文章内容</label>
        <div class="wmd-panel">
          <div id="wmd-button-bar"></div>
          <%=f.text_area :content, class: 'wmd-input', id: 'wmd-input', rows: 20, 'v-model'=> 'input'%>
        </div>
        <label>预览</label>
        <div class="wmd-panel">
          <div id="wmd-preview" class="wmd-preview"></div>
        </div>
      </div>

      <div class="form-group">
          <label for="PostImage">课程图片</label>
            <input type="file" name="file" id="eyecatch_upload"><br />
            <img id="eyecatch_url" src="" style="width: 140px; height: 140px;"/>
      </div>

      <div class="form-group">
        <label>发布时间</label>
        <%= @post.new_record?  ? Time.now : @post.created_at %>
      </div>

      <div class="form-group">
        <label class="control-label">大分类</label>
        <div id="category_select">
          <% @categories.each do |category| %>
          <div class="checkbox-inline">
            <%= f.check_box(:categories, {multiple: true}, category.name, nil) %>
            <%= f.label category.name %>
          </div>
          <% end %>
        </div>
        <button type="button" class="btn btn-mini" data-toggle="modal" data-target="#new_category_modal">
          添加
        </button>
      </div>
      <button type="submit" class="btn btn-primary">保存</button>
    <% end %>
        <div class="modal fade" id="new_category_modal" tabindex="-1" role="dialog">
          <%= render partial: 'common/new_category_modal'%>
        </div>
  </div>
  </div>
  

<!-- Include jquery.uplaod-1.0.2.min.js For Realtime Image Display -->
<script>
 (function () {
                var converter1 = Markdown.getSanitizingConverter();
                converter1.hooks.chain("preBlockGamut", function (text, rbg) {
                    return text.replace(/^ {0,3}""" *\n((?:.*?\n)+?) {0,3}""" *$/gm, function (whole, inner) {
                        return "<blockquote>" + rbg(inner) + "</blockquote>\n";
                    });
                });
                var editor1 = new Markdown.Editor(converter1);
                editor1.run();
            })();
</script>
