<% content_for :extra_head do %>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/assets/md_preview.css" />
  <script type="text/javascript" src="/assets/Markdown.Converter.js"></script>
  <script type="text/javascript" src="/assets/Markdown.Sanitizer.js"></script>
  <script type="text/javascript" src="/assets/Markdown.Editor.js"></script>
<% end %>
<!-- Page Content -->
  <div class="row">
      <div class="col-lg-12">
        <h1 class="page-header">
          编辑活动
          </h1>
      </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      <%= form_for @event do |f| %>
      <div class="form-group">
        <label>活动名称</label>
        <%=f.text_field :title, class: 'form-control' %>
        <%=f.hidden_field :id, value: @event.id, class: 'form-control', required: true %>
      </div>

      <div class="form-group">
        <label>活动日程</label>
          <%=f.text_field :timestart, class: " datetimepicker", required: true %>
          ~ <%=f.text_field :timeend, class: " datetimepicker", required: true %>
      </div>
      <div class="form-group">
        <label>费用</label>
          <%=f.text_field :fee, required: true %>
        <label>人数限制</label>
          <%=f.number_field :limit, required: true %>
      </div>
      <div class="form-group">
        <label>简介</label>
        <%=f.text_area :description, class: 'form-control', rows: 4, required: true %>
      </div>

      <div class="form-group" id='editor'>
        <label>活动内容</label>
        <div class="wmd-panel">
          <div id="wmd-button-bar"></div>
          <%=f.text_area :content, class: 'wmd-input', id: 'wmd-input', rows: 20, 'v-model'=> 'input', required: true %>
        </div>
        <label>预览</label>
        <div class="wmd-panel">
          <div id="wmd-preview" class="wmd-preview"></div>
        </div>
      </div>

      <div class="form-group">
          <label for="PostImage">活动图片</label>
            <%= f.file_field :image, id: "eyecatch_upload", onchange: "previewFile()" %><br />
            <%= image_tag @event.image, id: "eyecatch_url",style: "width: 140px; height: 140px;" %>
      </div>

      </div>
      <button type="submit" class="btn btn-primary">保存</button>
    <% end %>
  </div>
  

<link rel="stylesheet" href="/assets/jquery.datetimepicker.css" />
<script type="text/javascript" src="/assets/jquery.datetimepicker.js"></script>
<script>
 (function () {
                var converter1 = Markdown.getSanitizingConverter();
                converter1.hooks.chain("preBlockGamut", function (text, rbg) {
                    return text.replace(/^ {0,3}""" *\n((?:.*?\n)+?) {0,3}""" *$/gm, function (whole, inner) {
                        return "<blockquote>" + rbg(inner) + "</blockquote>\n";
                    });
                });
                var editor1 = new Markdown.Editor(converter1);
                editor1.run();
            })();
</script>
<script>
function previewFile() {
  var preview = document.getElementById('eyecatch_url');
  var file    = document.getElementById('eyecatch_upload').files[0];
  var reader  = new FileReader();

  reader.onloadend = function () {
    preview.src = reader.result;
  }

  if (file) {
    reader.readAsDataURL(file);
  } else {
    preview.src = "";
  }
}
$('.datetimepicker').datetimepicker({
    format: 'Y-m-d H:i',
});
</script>

